<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Woodora - Create Order</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f9f9f9;
        }
        .order-form-container {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 50px auto;
        }
        .order-form-container h2 {
            font-weight: 600;
            color: #333;
        }
        .form-label {
            font-weight: 500;
            color: #444;
        }
        .btn-woodora {
            background: #8b4513;
            color: #fff;
        }
        .btn-woodora:hover {
            background: #6f3410;
            color: #fff;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="order-form-container">
        <h2 class="text-center mb-4">ðŸª‘ Create New Furniture Order</h2>
        <form id="orderForm">

            <!-- Customer Email & Qty -->
            <div class="row mb-3 g-3">
                <div class="col-md-12">
                    <label for="email" class="form-label">Customer Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your Email" required>
                </div>
                <div class="col-md-6">
                    <label for="qty" class="form-label">Order Quantity</label>
                    <input type="number" class="form-control" placeholder="Qty" id="qty" required>
                </div>
                <div class="col-md-6">
                    <label for="orderType" class="form-label">Order Type</label>
                    <select class="form-select" id="orderType" required>
                        <option value="Takeaway">Takeaway</option>
                        <option value="Delivery">Delivery</option>
                    </select>
                </div>
            </div>

            <!-- Order Date & Status -->
            <div class="row mb-3 g-3">
                <div class="col-md-6">
                    <label for="orderDatetime" class="form-label">Order Date</label>
                    <input type="date" class="form-control" id="orderDatetime" required>
                </div>
                <div class="col-md-6">
                    <input type="hidden" id="status" value="Pending">
                </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-between">
                <button type="button" id="orderSave" class="btn btn-woodora btn-sm w-100 mx-1">Submit Order</button>
                <a href="#" style="text-decoration: none">
                    <button type="button" id="openDelivery"
                            class="btn btn-sm w-100 mx-1 text-white"
                            data-bs-toggle="modal" data-bs-target="#deliveryModal"
                            style="background: #e67e22;">
                        Delivery
                    </button>
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!--delivery-->


<div class="modal fade" id="deliveryModal" tabindex="-1" aria-labelledby="deliveryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deliveryModalLabel">Delivery Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Left: Delivery Form -->
                    <div class="col-md-6">
                        <form id="deliveryForm">
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullName" placeholder="Full Name" style=" border: 2px solid #e67e22; " required>
                            </div>

                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="phoneNumber" placeholder="Phone Number" style=" border: 2px solid #e67e22; " required>
                            </div>

                            <div class="mb-3">
                                <label for="deliveryEmail" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="deliveryEmail" placeholder="your@email.com" style=" border: 2px solid #e67e22; " required>
                            </div>

                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="address" placeholder="Enter your address" style=" border: 2px solid #e67e22; " required>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="deliveryDate" class="form-label">Delivery Date</label>
                                    <input type="date" class="form-control" style=" border: 2px solid #e67e22; " id="deliveryDate" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="deliveryTime" class="form-label">Delivery Time</label>
                                    <input type="time" class="form-control" style=" border: 2px solid #e67e22; " id="deliveryTime" required>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Right: Image -->
<!--                    <div class="col-md-6 d-flex align-items-center justify-content-center">-->
<!--                        <img src="Assets/images/46312.jpg" alt="Delivery Illustration" class="img-fluid rounded">-->
<!--                    </div>-->
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="deliveryButton" class="btn text-white" style="background-color: #e67e22">Submit Now</button>
            </div>
        </div>
    </div>
</div>


<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="javascript/order.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>

<script>

    $(document).ready(function () {
        $('#deliveryButton').on('click', function (e) {
            e.preventDefault();

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const deliveryData = {
                        fullName: $('#fullName').val(),
                        phoneNumber: $('#phoneNumber').val(),
                        email: $('#deliveryEmail').val(),
                        address: $('#address').val(),
                        date: $('#deliveryDate').val(),
                        time: $('#deliveryTime').val(),
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };

                    sendDelivery(deliveryData);
                }, function () {
                    alert("Location access denied");
                });
            } else {
                alert("Geolocation is not supported");
            }
        });

        function sendDelivery(deliveryData) {
            $.ajax({
                url: "http://localhost:8080/api/v1/delivery/save",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(deliveryData),
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("token")
                },
                success: function (response) {
                    Swal.fire({
                        icon: "success",
                        title: "Success!",
                        text: response.message
                    });
                    $('#deliveryForm')[0].reset();
                },
                error: function (xhr) {
                    Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: xhr.responseJSON?.message || "Something went wrong!"
                    });
                }
            });
        }

    });
</script>
</body>
</html>
